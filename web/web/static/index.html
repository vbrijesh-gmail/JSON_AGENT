<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>JSON Agent UI</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 2rem; background: #0b1020; color: #e8eaf0; }
      .card { background: #121735; border: 1px solid #263269; border-radius: 12px; padding: 20px; max-width: 900px; }
      textarea { width: 100%; min-height: 120px; border-radius: 8px; border: 1px solid #2c3b7a; background: #0e1533; color: #e8eaf0; padding: 10px; }
      input[type="file"], input[type="text"] { color: #e8eaf0; }
      button { background: #4f46e5; color: white; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; }
      button:disabled { opacity: .7; cursor: not-allowed; }
      .row { display: flex; gap: 16px; margin: 10px 0; align-items: center; }
      pre { background: #0e1533; border: 1px solid #2c3b7a; border-radius: 8px; padding: 12px; overflow: auto; }
      .label { font-size: 0.9rem; color: #b7c1f8; }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      function App() {
        const [prompt, setPrompt] = React.useState("");
        const [file, setFile] = React.useState(null);
        const [result, setResult] = React.useState(null);
        const [loading, setLoading] = React.useState(false);
        const [error, setError] = React.useState(null);

        const handleSubmit = async (e) => {
          e.preventDefault();
          setError(null);
          setResult(null);
          if (!prompt || !file) { setError("Please provide a prompt and a JSON file."); return; }
          const form = new FormData();
          form.append("prompt", prompt);
          form.append("file", file);
          setLoading(true);
          try {
            const res = await fetch("/api/modify", { method: "POST", body: form });
            if (!res.ok) {
              const t = await res.json().catch(() => ({}));
              throw new Error(t.detail || `Request failed (${res.status})`);
            }
            const data = await res.json();
            setResult(data.updated);
          } catch (err) {
            setError(err.message);
          } finally {
            setLoading(false);
          }
        };

        return (
          <div className="card">
            <h2>JSON Agent</h2>
            <form onSubmit={handleSubmit}>
              <div className="row">
                <label className="label">Prompt</label>
              </div>
              <textarea placeholder="Describe the modifications..." value={prompt} onChange={(e) => setPrompt(e.target.value)} />

              <div className="row">
                <label className="label">JSON File</label>
                <input type="file" accept="application/json,.json" onChange={(e) => setFile(e.target.files?.[0] || null)} />
              </div>

              <div className="row">
                <button type="submit" disabled={loading}>{loading ? "Running..." : "Run"}</button>
              </div>
            </form>

            {error && <p style={{color:'#ffa7a7'}}>{error}</p>}
            {result && (
              <div>
                <h3>Updated JSON</h3>
                <pre>{JSON.stringify(result, null, 2)}</pre>
              </div>
            )}
          </div>
        );
      }
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
